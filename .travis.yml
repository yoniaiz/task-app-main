language: generic
sudo: required
services:
  - docker

before_install:
  - docker pull mongo
  - docker build -t yonatanaiz/server -f ./tasksapp/server/Dockerfile.dev ./tasksapp/server
  - docker build -t yonatanaiz/client -f ./tasksapp/front/Dockerfile.dev ./tasksapp/front

script:
  - docker run -d -p 27017-27019:27017-27019 --name mongodb --bind_ip_all mongo
  - docker run -e CI=true yonatanaiz/server npm run docker-test
  - docker run -e CI=true yonatanaiz/client npm run test

after_success:
  - docker build -t yonatanaiz/server -f ./tasksapp/server/Dockerfile.dev ./tasksapp/server
  - docker build -t yonatanaiz/client -f ./tasksapp/front/Dockerfile.dev ./tasksapp/front
